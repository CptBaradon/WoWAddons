local SCL_CONSTS = {}

SCL_CONSTS.CLASSCOLOR = {}
SCL_CONSTS.CLASSCOLOR["DRUID"]      = "ff7d0a"
SCL_CONSTS.CLASSCOLOR["HUNTER"]     = "abd473"
SCL_CONSTS.CLASSCOLOR["MAGE"]       = "69ccf0"
SCL_CONSTS.CLASSCOLOR["PALADIN"]    = "f58cba"
SCL_CONSTS.CLASSCOLOR["PRIEST"]     = "ffffff"
SCL_CONSTS.CLASSCOLOR["ROGUE"]      = "fff569"
SCL_CONSTS.CLASSCOLOR["SHAMAN"]     = "0070de"
SCL_CONSTS.CLASSCOLOR["WARLOCK"]    = "9482c9"
SCL_CONSTS.CLASSCOLOR["WARRIOR"]    = "c79c6e"

SCL_CONSTS.CLASSICONS = {}
SCL_CONSTS.CLASSICONS["DRUID"]      = "Interface\\Addons\\SpikesCharLink\\Media\\Druid"
SCL_CONSTS.CLASSICONS["HUNTER"]     = "Interface\\Addons\\SpikesCharLink\\Media\\Hunter"
SCL_CONSTS.CLASSICONS["MAGE"]       = "Interface\\Addons\\SpikesCharLink\\Media\\Mage"
SCL_CONSTS.CLASSICONS["PALADIN"]    = "Interface\\Addons\\SpikesCharLink\\Media\\Paladin"
SCL_CONSTS.CLASSICONS["PRIEST"]     = "Interface\\Addons\\SpikesCharLink\\Media\\Priest"
SCL_CONSTS.CLASSICONS["ROGUE"]      = "Interface\\Addons\\SpikesCharLink\\Media\\Rogue"
SCL_CONSTS.CLASSICONS["SHAMAN"]     = "Interface\\Addons\\SpikesCharLink\\Media\\Shaman"
SCL_CONSTS.CLASSICONS["WARLOCK"]    = "Interface\\Addons\\SpikesCharLink\\Media\\Warlock"
SCL_CONSTS.CLASSICONS["WARRIOR"]    = "Interface\\Addons\\SpikesCharLink\\Media\\Warrior"

SCL_CONSTS.QUALITYCOLOR = {}
SCL_CONSTS.QUALITYCOLOR["POOR"]         = "9d9d9d"
SCL_CONSTS.QUALITYCOLOR["COMMON"]       = "ffffff"
SCL_CONSTS.QUALITYCOLOR["UNCOMMON"]     = "1eff00"
SCL_CONSTS.QUALITYCOLOR["RARE"]         = "0070dd"
SCL_CONSTS.QUALITYCOLOR["EPIC"]         = "a335ee"
SCL_CONSTS.QUALITYCOLOR["LEGENDARY"]    = "ff8000"
SCL_CONSTS.QUALITYCOLOR["ARTIFACT"]     = "e6cc80"
SCL_CONSTS.QUALITYCOLOR["HEIRLOOM"]     = "00ccff"

SCL_CONSTS.SLOTIDSTRING = {}
SCL_CONSTS.SLOTIDSTRING["1"]  = "HEADSLOT"
SCL_CONSTS.SLOTIDSTRING["2"]  = "NECKSLOT"
SCL_CONSTS.SLOTIDSTRING["3"]  = "SHOULDERSLOT"
SCL_CONSTS.SLOTIDSTRING["4"]  = "BACKSLOT"
SCL_CONSTS.SLOTIDSTRING["5"]  = "CHESTSLOT"
SCL_CONSTS.SLOTIDSTRING["6"]  = "SHIRTSLOT"
SCL_CONSTS.SLOTIDSTRING["7"]  = "TABARDSLOT"
SCL_CONSTS.SLOTIDSTRING["8"]  = "WRISTSLOT"
SCL_CONSTS.SLOTIDSTRING["9"]  = "HANDSSLOT"
SCL_CONSTS.SLOTIDSTRING["10"] = "WAISTSLOT"
SCL_CONSTS.SLOTIDSTRING["11"] = "LEGSSLOT"
SCL_CONSTS.SLOTIDSTRING["12"] = "FEETSLOT"
SCL_CONSTS.SLOTIDSTRING["13"] = "FINGER0SLOT"
SCL_CONSTS.SLOTIDSTRING["14"] = "FINGER1SLOT"
SCL_CONSTS.SLOTIDSTRING["15"] = "TRINKET0SLOT"
SCL_CONSTS.SLOTIDSTRING["16"] = "TRINKET1SLOT"
SCL_CONSTS.SLOTIDSTRING["17"] = "MAINHANDSLOT"
SCL_CONSTS.SLOTIDSTRING["18"] = "SECONDARYHANDSLOT"
SCL_CONSTS.SLOTIDSTRING["19"] = "RANGEDSLOT"

SCL_CONSTS.SLOTIDICON = {}
SCL_CONSTS.SLOTIDICON["0"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Head"
SCL_CONSTS.SLOTIDICON["1"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Neck"
SCL_CONSTS.SLOTIDICON["2"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Shoulder"
SCL_CONSTS.SLOTIDICON["3"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Chest"
SCL_CONSTS.SLOTIDICON["4"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Chest"
SCL_CONSTS.SLOTIDICON["5"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Wrists"
SCL_CONSTS.SLOTIDICON["6"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Hands"
SCL_CONSTS.SLOTIDICON["7"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Waist"
SCL_CONSTS.SLOTIDICON["8"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Legs"
SCL_CONSTS.SLOTIDICON["9"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Feet"
SCL_CONSTS.SLOTIDICON["10"] = "Interface\\PaperDoll\\UI-PaperDoll-Slot-RFinger"
SCL_CONSTS.SLOTIDICON["11"] = "Interface\\PaperDoll\\UI-PaperDoll-Slot-RFinger"
SCL_CONSTS.SLOTIDICON["12"] = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Trinket"
SCL_CONSTS.SLOTIDICON["13"] = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Trinket"
SCL_CONSTS.SLOTIDICON["14"] = "Interface\\PaperDoll\\UI-PaperDoll-Slot-MainHand"
SCL_CONSTS.SLOTIDICON["15"] = "Interface\\PaperDoll\\UI-PaperDoll-Slot-SecondaryHand"
SCL_CONSTS.SLOTIDICON["16"] = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Ranged"

SCL_CONSTS.SLOTSTRINGICON = {}
SCL_CONSTS.SLOTSTRINGICON["HEADSLOT"]           = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Head"
SCL_CONSTS.SLOTSTRINGICON["NECKSLOT"]           = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Neck"
SCL_CONSTS.SLOTSTRINGICON["SHOULDERSLOT"]       = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Shoulder"
SCL_CONSTS.SLOTSTRINGICON["BACKSLOT"]           = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Chest"
SCL_CONSTS.SLOTSTRINGICON["CHESTSLOT"]          = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Chest"
SCL_CONSTS.SLOTSTRINGICON["SHIRTSLOT"]          = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Shirt"
SCL_CONSTS.SLOTSTRINGICON["TABARDSLOT"]         = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Tabard"
SCL_CONSTS.SLOTSTRINGICON["WRISTSLOT"]          = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Wrists"
SCL_CONSTS.SLOTSTRINGICON["HANDSSLOT"]          = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Hands"
SCL_CONSTS.SLOTSTRINGICON["WAISTSLOT"]          = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Waist"
SCL_CONSTS.SLOTSTRINGICON["LEGSSLOT"]           = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Legs"
SCL_CONSTS.SLOTSTRINGICON["FEETSLOT"]           = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Feet"
SCL_CONSTS.SLOTSTRINGICON["FINGER0SLOT"]        = "Interface\\PaperDoll\\UI-PaperDoll-Slot-RFinger"
SCL_CONSTS.SLOTSTRINGICON["FINGER1SLOT"]        = "Interface\\PaperDoll\\UI-PaperDoll-Slot-RFinger"
SCL_CONSTS.SLOTSTRINGICON["TRINKET0SLOT"]       = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Trinket"
SCL_CONSTS.SLOTSTRINGICON["TRINKET1SLOT"]       = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Trinket"
SCL_CONSTS.SLOTSTRINGICON["MAINHANDSLOT"]       = "Interface\\PaperDoll\\UI-PaperDoll-Slot-MainHand"
SCL_CONSTS.SLOTSTRINGICON["SECONDARYHANDSLOT"]  = "Interface\\PaperDoll\\UI-PaperDoll-Slot-SecondaryHand"
SCL_CONSTS.SLOTSTRINGICON["RANGEDSLOT"]         = "Interface\\PaperDoll\\UI-PaperDoll-Slot-Ranged"

SCL_CONSTS.CLASSTOSTRINGID = {}
SCL_CONSTS.CLASSTOSTRINGID["PRIEST"]    = "0"
SCL_CONSTS.CLASSTOSTRINGID["MAGE"]      = "1"
SCL_CONSTS.CLASSTOSTRINGID["ROGUE"]     = "2"
SCL_CONSTS.CLASSTOSTRINGID["WARRIOR"]   = "3"
SCL_CONSTS.CLASSTOSTRINGID["WARLOCK"]   = "4"
SCL_CONSTS.CLASSTOSTRINGID["DRUID"]     = "5"
SCL_CONSTS.CLASSTOSTRINGID["PALADIN"]   = "6"
SCL_CONSTS.CLASSTOSTRINGID["SHAMAN"]    = "7"
SCL_CONSTS.CLASSTOSTRINGID["HUNTER"]    = "8"

SCL_CONSTS.STRINGIDTOCLASS = {}
SCL_CONSTS.STRINGIDTOCLASS["0"]    = "PRIEST"
SCL_CONSTS.STRINGIDTOCLASS["1"]      = "MAGE"
SCL_CONSTS.STRINGIDTOCLASS["2"]     = "ROGUE"
SCL_CONSTS.STRINGIDTOCLASS["3"]   = "WARRIOR"
SCL_CONSTS.STRINGIDTOCLASS["4"]   = "WARLOCK"
SCL_CONSTS.STRINGIDTOCLASS["5"]     = "DRUID"
SCL_CONSTS.STRINGIDTOCLASS["6"]   = "PALADIN"
SCL_CONSTS.STRINGIDTOCLASS["7"]    = "SHAMAN"
SCL_CONSTS.STRINGIDTOCLASS["8"]    = "HUNTER"

SCL_CONSTS.RACETOSTRINGID = {}
SCL_CONSTS.RACETOSTRINGID["Mensch"]     = "0"
SCL_CONSTS.RACETOSTRINGID["Nachtelf"]   = "1"
SCL_CONSTS.RACETOSTRINGID["Nachtelfe"]  = "1"
SCL_CONSTS.RACETOSTRINGID["Zwerg"]      = "2"
SCL_CONSTS.RACETOSTRINGID["Zwergin"]    = "2"
SCL_CONSTS.RACETOSTRINGID["Gnom"]       = "3"
SCL_CONSTS.RACETOSTRINGID["Gnomin"]     = "3"
SCL_CONSTS.RACETOSTRINGID["Draenei"]    = "4"
SCL_CONSTS.RACETOSTRINGID["Orc"]        = "5"
SCL_CONSTS.RACETOSTRINGID["Tauren"]     = "6"
SCL_CONSTS.RACETOSTRINGID["Troll"]      = "7"
SCL_CONSTS.RACETOSTRINGID["Untoter"]    = "8"
SCL_CONSTS.RACETOSTRINGID["Untote"]     = "8"
SCL_CONSTS.RACETOSTRINGID["Blutelf"]    = "9"
SCL_CONSTS.RACETOSTRINGID["Blutelfe"]   = "9"

SCL_CONSTS.STRINGIDTORACE = {}
SCL_CONSTS.STRINGIDTORACE["0"] = "Mensch"
SCL_CONSTS.STRINGIDTORACE["1"] = "Nachtelf"
SCL_CONSTS.STRINGIDTORACE["2"] = "Zwerg"
SCL_CONSTS.STRINGIDTORACE["3"] = "Gnom"
SCL_CONSTS.STRINGIDTORACE["4"] = "Draenei"
SCL_CONSTS.STRINGIDTORACE["5"] = "Orc"
SCL_CONSTS.STRINGIDTORACE["6"] = "Tauren"
SCL_CONSTS.STRINGIDTORACE["7"] = "Troll"
SCL_CONSTS.STRINGIDTORACE["8"] = "Untoter"
SCL_CONSTS.STRINGIDTORACE["9"] = "Blutelf"

SCL_CONSTS.RACESEXTOTEXTURE = {}
SCL_CONSTS.RACESEXTOTEXTURE["Mensch2"]     = "Interface\\CharacterFrame\\TemporaryPortrait-Male-Human"
SCL_CONSTS.RACESEXTOTEXTURE["Mensch3"]     = "Interface\\CharacterFrame\\TemporaryPortrait-Female-Human"
SCL_CONSTS.RACESEXTOTEXTURE["Nachtelf2"]   = "Interface\\CharacterFrame\\TemporaryPortrait-Male-NightElf"
SCL_CONSTS.RACESEXTOTEXTURE["Nachtelf3"]   = "Interface\\CharacterFrame\\TemporaryPortrait-Female-NightElf"
SCL_CONSTS.RACESEXTOTEXTURE["Zwerg2"]      = "Interface\\CharacterFrame\\TemporaryPortrait-Male-Dwarf"
SCL_CONSTS.RACESEXTOTEXTURE["Zwerg3"]      = "Interface\\CharacterFrame\\TemporaryPortrait-Female-Dwarf"
SCL_CONSTS.RACESEXTOTEXTURE["Gnom2"]       = "Interface\\CharacterFrame\\TemporaryPortrait-Male-Gnome"
SCL_CONSTS.RACESEXTOTEXTURE["Gnom3"]       = "Interface\\CharacterFrame\\TemporaryPortrait-Female-Gnome"
SCL_CONSTS.RACESEXTOTEXTURE["Draenei2"]    = "Interface\\CharacterFrame\\TemporaryPortrait-Male-Draenei"
SCL_CONSTS.RACESEXTOTEXTURE["Draenei3"]    = "Interface\\CharacterFrame\\TemporaryPortrait-Female-Draenei"
SCL_CONSTS.RACESEXTOTEXTURE["Orc2"]        = "Interface\\CharacterFrame\\TemporaryPortrait-Male-Orc"
SCL_CONSTS.RACESEXTOTEXTURE["Orc3"]        = "Interface\\CharacterFrame\\TemporaryPortrait-Female-Orc"
SCL_CONSTS.RACESEXTOTEXTURE["Tauren2"]     = "Interface\\CharacterFrame\\TemporaryPortrait-Male-Tauren"
SCL_CONSTS.RACESEXTOTEXTURE["Tauren3"]     = "Interface\\CharacterFrame\\TemporaryPortrait-Female-Tauren"
SCL_CONSTS.RACESEXTOTEXTURE["Troll2"]      = "Interface\\CharacterFrame\\TemporaryPortrait-Male-Troll"
SCL_CONSTS.RACESEXTOTEXTURE["Troll3"]      = "Interface\\CharacterFrame\\TemporaryPortrait-Female-Troll"
SCL_CONSTS.RACESEXTOTEXTURE["Untoter2"]    = "Interface\\CharacterFrame\\TemporaryPortrait-Male-Scourge"
SCL_CONSTS.RACESEXTOTEXTURE["Untoter3"]    = "Interface\\CharacterFrame\\TemporaryPortrait-Female-Scourge"
SCL_CONSTS.RACESEXTOTEXTURE["Blutelf2"]    = "Interface\\CharacterFrame\\TemporaryPortrait-Male-BloodElf"
SCL_CONSTS.RACESEXTOTEXTURE["Blutelf3"]    = "Interface\\CharacterFrame\\TemporaryPortrait-Female-BloodElf"
SCL_CONSTS.RACESEXTOTEXTURE["DEFAULT"]     = "Interface\\CharacterFrame\\TempPortrait"

SCL_CONSTS.CLASSTALENTSTRINGS = {}
SCL_CONSTS.CLASSTALENTSTRINGS["PRIEST"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["PRIEST"][1] = "Discipline"
SCL_CONSTS.CLASSTALENTSTRINGS["PRIEST"][2] = "Holy"
SCL_CONSTS.CLASSTALENTSTRINGS["PRIEST"][3] = "Shadow"

SCL_CONSTS.CLASSTALENTSTRINGS["MAGE"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["MAGE"][1] = "Arcane"
SCL_CONSTS.CLASSTALENTSTRINGS["MAGE"][2] = "Fire"
SCL_CONSTS.CLASSTALENTSTRINGS["MAGE"][3] = "Frost"

SCL_CONSTS.CLASSTALENTSTRINGS["ROGUE"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["ROGUE"][1] = "Assassination"
SCL_CONSTS.CLASSTALENTSTRINGS["ROGUE"][2] = "Combat"
SCL_CONSTS.CLASSTALENTSTRINGS["ROGUE"][3] = "Subtlety"

SCL_CONSTS.CLASSTALENTSTRINGS["WARRIOR"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["WARRIOR"][1] = "Arms"
SCL_CONSTS.CLASSTALENTSTRINGS["WARRIOR"][2] = "Fury"
SCL_CONSTS.CLASSTALENTSTRINGS["WARRIOR"][3] = "Protection"

SCL_CONSTS.CLASSTALENTSTRINGS["WARLOCK"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["WARLOCK"][1] = "Affliction"
SCL_CONSTS.CLASSTALENTSTRINGS["WARLOCK"][2] = "Demonology"
SCL_CONSTS.CLASSTALENTSTRINGS["WARLOCK"][3] = "Destruction"

SCL_CONSTS.CLASSTALENTSTRINGS["DRUID"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["DRUID"][1] = "Balance"
SCL_CONSTS.CLASSTALENTSTRINGS["DRUID"][2] = "Feral"
SCL_CONSTS.CLASSTALENTSTRINGS["DRUID"][3] = "Restoration"

SCL_CONSTS.CLASSTALENTSTRINGS["PALADIN"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["PALADIN"][1] = "Holy"
SCL_CONSTS.CLASSTALENTSTRINGS["PALADIN"][2] = "Protection"
SCL_CONSTS.CLASSTALENTSTRINGS["PALADIN"][3] = "Retribution"

SCL_CONSTS.CLASSTALENTSTRINGS["SHAMAN"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["SHAMAN"][1] = "Elemental"
SCL_CONSTS.CLASSTALENTSTRINGS["SHAMAN"][2] = "Enhancement"
SCL_CONSTS.CLASSTALENTSTRINGS["SHAMAN"][3] = "Restoration"

SCL_CONSTS.CLASSTALENTSTRINGS["HUNTER"] = {}
SCL_CONSTS.CLASSTALENTSTRINGS["HUNTER"][1] = "Beast Mastery"
SCL_CONSTS.CLASSTALENTSTRINGS["HUNTER"][2] = "Marksmanship"
SCL_CONSTS.CLASSTALENTSTRINGS["HUNTER"][3] = "Survival"



--["Human"] = "Mensch",
--["Night elf"] = "Nachtelf",
--["Dwarf"] = "Zwerg",
--["Gnome"] = "Gnom",
--["Draenei"] = "Draenei",
--
--["Orc"] = "Orc",
--["Tauren"] = "Tauren",
--["Troll"] = "Troll",
--["Undead"] = "Untoter",
--["Blood elf"] = "Blutelf",



local SCL_PLAYER = {}

local origChatFrame_OnHyperlinkShow = ChatFrame_OnHyperlinkShow;
ChatFrame_OnHyperlinkShow = function(...)
    local chatFrame, link, text, button = ...;

    local r,g,b,itemID,linkType,simpleData,simpleTalents,simpleStats,F,G,H,name = link:match("^|cff(%x%x)(%x%x)(%x%x)|Hitem:(%d+):(%d+):(%d+):(%d+):(%d+):(%d+):(%-?%d+):(%d+)|h%[(.+)%]|h|r$")

    -- linkType = flag (1 = player)
    -- simpleData = Level, Race, Class etc.
    if(itemID == "1" and linkType == "1") then

        SCL_DeserializeBaseinfoString(name, simpleData)
        SCL_DeserializePlayerTalentsSimple(name, simpleTalents)
        SCL_DeserializePlayerStatsSimple(name, simpleStats)

        SendAddonMessage("SCLRI", "REQUEST_ITEMS", "WHISPER", name);

        return;
    end
    
    return origChatFrame_OnHyperlinkShow(...);
end

local origCharacterFrame_ShowSubFrame = CharacterFrame_ShowSubFrame;
CharacterFrame_ShowSubFrame = function(...)
    local frameName = ...;

    if(frameName == "PaperDollFrame") then
        SCL_CharWindowButtonFrame:Show()
    else
        SCL_CharWindowButtonFrame:Hide()
    end

    return origCharacterFrame_ShowSubFrame(...);
end

-- working
--local origDoEmote = DoEmote;
--DoEmote = function(...)
--    DEFAULT_CHAT_FRAME:AddMessage("EMOTE")
--    --local frameName = ...;
--    --
--    --if(frameName == "PaperDollFrame") then
--    --    SCL_CharWindowButtonFrame:Show()
--    --else
--    --    SCL_CharWindowButtonFrame:Hide()
--    --end
--
--    return origDoEmote(...);
--end

--local origSendChatMessage = SendChatMessage;
--SendChatMessage = function(...)
--    DEFAULT_CHAT_FRAME:AddMessage("CHATMESSAGE")
--    return origSendChatMessage
--end

function SCL_DeserializePlayerStatsSimple(name, simpleData)
    if not (SCL_PLAYER[name]) then
        SCL_PLAYER[name] = {}
    end

    SCL_PLAYER[name]["MANAMAX"] = SCL_LTrim(string.sub(simpleData, 1, 5), "0")
    SCL_PLAYER[name]["HEALTHMAX"] = SCL_LTrim(string.sub(simpleData, 6, 10), "0")
end

function SCL_LTrim(strString, strTrimchar)
    while string.sub(strString, 1, 1) == strTrimchar do
        strString = string.sub(strString, 2, string.len(strString))
    end

    return strString
end

function SCL_DeserializeBaseinfoString(name, simpleData)
    if not (SCL_PLAYER[name]) then
        SCL_PLAYER[name] = {}
    end

    -- LLCRS
    -- LL = Level
    -- C  = Class
    -- R = Race
    -- S  = Sex
    SCL_PLAYER[name]["LEVEL"] = string.sub(simpleData, 1, 2)
    SCL_PLAYER[name]["CLASS"] = SCL_CONSTS.STRINGIDTOCLASS[string.sub(simpleData, 3, 3)]
    SCL_PLAYER[name]["RACE"] = SCL_CONSTS.STRINGIDTORACE[string.sub(simpleData, 4, 4)]
    SCL_PLAYER[name]["SEX"] = string.sub(simpleData, 5, 5)

end

function SCL_OnLoad()
    this:RegisterEvent('VARIABLES_LOADED');
    this:RegisterEvent('CHAT_MSG_ADDON');
    --this:RegisterEvent('CHAT_MSG_TEXT_EMOTE');
    
    SLASH_SPIKESCHARLINK1 = "/scl";
    SLASH_SPIKESCHARLINK2 = "/charlink";
    SlashCmdList["SPIKESCHARLINK"] = function(msg)
        SCL_SlashCommandHandler(msg);
    end

    SLASH_SPIKESCHARLINK21 = "/wavel";
    SlashCmdList["SPIKESCHARLINK2"] = function(msg)
        SCL_SlashCommandHandlerW(msg);
    end

    DEFAULT_CHAT_FRAME:AddMessage("SpikesCharLink loaded!");
end

function SCL_SlashCommandHandlerW(msg)

    DoEmote("wave", "target")

    if(UnitIsPlayer("target")) then
        targetplayer, realm = UnitName("target")

        DEFAULT_CHAT_FRAME:AddMessage("Target: " ..targetplayer)

        if(targetplayer) then
            SendChatMessage("Charlink: " ..SCL_BuildPlayerString(), "WHISPER", nil, targetplayer);
        end
    end

    --DEFAULT_CHAT_FRAME:AddMessage("W");
end

function SCL_SlashCommandHandler(msg)
    local a, b, command = string.find( msg, "(%w+)" );

    --DEFAULT_CHAT_FRAME:AddMessage(msg .. " ")

    if( command == nil ) then
        return;
    else
        command = string.lower( msg );
    end

    if (command == "ser") then
        SCL_SerializePlayerStatsDefense()
        SCL_SerializePlayerStatsSpell()
        SCL_SerializePlayerStatsRange()
        SCL_SerializePlayerStatsMelee()
        SCL_SerializePlayerStats()
    end

    --if (command == "guild") then
    --    SendChatMessage("Invite me: " ..SCL_BuildPlayerString(), "GUILD");
    --elseif (command == "party") then
    --    SendChatMessage("Invite me: " ..SCL_BuildPlayerString(), "PARTY");
    --elseif(command == "window") then
    --    SCL_ShowCharWindow()
    --elseif(command == "hide") then
    --    SCL_InspectFrame:Hide()
    --elseif(command == "serialize" or command == "ser") then
    --    SCL_SerializePlayer()
    --elseif(command == "talents") then
    --    SCL_SerializePlayerTalentsSimple()
    --elseif(command == "ti") then
    --    SCL_DeserializePlayerTalentsSimple(SCL_SerializePlayerTalentsSimple())
    --end

end

function SCL_Sign(v)
    return (v >= 0 and 1) or -1
end

function SCL_Round(v, bracket)
    bracket = bracket or 1
    return math.floor(v/bracket + SCL_Sign(v) * 0.5) * bracket
end

function SCL_SerializePlayerStats()
    base, strength, posBuff, negBuff = UnitStat("player", 1);
    base, agility, posBuff, negBuff = UnitStat("player", 2);
    base, stamina, posBuff, negBuff = UnitStat("player", 3);
    base, intellect, posBuff, negBuff = UnitStat("player", 4);
    base, spirit, posBuff, negBuff = UnitStat("player", 5);

    DEFAULT_CHAT_FRAME:AddMessage("strength: " .. strength)
    DEFAULT_CHAT_FRAME:AddMessage("agility: " .. agility)
    DEFAULT_CHAT_FRAME:AddMessage("stamina: " .. stamina)
    DEFAULT_CHAT_FRAME:AddMessage("intellect: " .. intellect)
    DEFAULT_CHAT_FRAME:AddMessage("spirit: " .. spirit)
end

function SCL_SerializePlayerStatsMelee()

    baseAttackpower, posBuff, negBuff = UnitAttackPower("player");
    DEFAULT_CHAT_FRAME:AddMessage("baseAttackpower: " .. (baseAttackpower + posBuff))

    armorPen = GetArmorPenetration()
    DEFAULT_CHAT_FRAME:AddMessage("armorPen: " .. armorPen)

    meleeHit = GetCombatRating(6)
    DEFAULT_CHAT_FRAME:AddMessage("meleeHit: " .. meleeHit)

    meleeCrit = GetCritChance()
    DEFAULT_CHAT_FRAME:AddMessage("meleeCrit: " .. SCL_Round(meleeCrit, 0.01))

    expertise, offhandExpertise = GetExpertise();
    DEFAULT_CHAT_FRAME:AddMessage("expertise: " .. expertise .. " offhandExpertise: " ..offhandExpertise)
end

function SCL_SerializePlayerStatsRange()

    speed, lowDmg, hiDmg, posBuff, negBuff, percent = UnitRangedDamage("player");
    DEFAULT_CHAT_FRAME:AddMessage("speed: " .. speed)

    rangedbase, posBuff, negBuff = UnitRangedAttackPower("player");
    DEFAULT_CHAT_FRAME:AddMessage("rangedbase: " .. rangedbase)

    rangedHit = GetCombatRating(7)
    DEFAULT_CHAT_FRAME:AddMessage("rangedHit: " .. rangedHit)

    rangedCrit = GetRangedCritChance() 
    DEFAULT_CHAT_FRAME:AddMessage("rangedCrit: " .. SCL_Round(rangedCrit, 0.01))
end

function SCL_SerializePlayerStatsSpell()

    spell = 0

    for i = 1, 7 do
        spellDmg = GetSpellBonusDamage(i);

        if (spell < spellDmg) then
            spell = spellDmg
        end
        --DEFAULT_CHAT_FRAME:AddMessage("spellDmg(" .. i .. "): " .. spellDmg)
    end
    DEFAULT_CHAT_FRAME:AddMessage("spell: " .. spell)

    spellcrit = 0

    for i = 1, 7 do
        theCritChance = GetSpellCritChance(i)
        if (spellcrit < theCritChance) then
            spellcrit = theCritChance
        end
        --DEFAULT_CHAT_FRAME:AddMessage("theCritChance(" .. i .. "): " .. theCritChance)
    end
    DEFAULT_CHAT_FRAME:AddMessage("spellcrit: " .. SCL_Round(spellcrit, 0.01))

    bonusHeal = GetSpellBonusHealing()
    DEFAULT_CHAT_FRAME:AddMessage("bonusHeal: " .. bonusHeal)

    hitSpell = GetCombatRating(8)
    DEFAULT_CHAT_FRAME:AddMessage("hitSpell: " .. hitSpell)

    --critSpell = GetCombatRating(11)
    --DEFAULT_CHAT_FRAME:AddMessage("critSpell: " .. critSpell)

    hasteSpell = GetCombatRating(20)
    DEFAULT_CHAT_FRAME:AddMessage("hasteSpell: " .. hasteSpell)

end

function SCL_SerializePlayerStatsDefense()
    base, effectiveArmor, armor, posBuff, negBuff = UnitArmor("player");
    DEFAULT_CHAT_FRAME:AddMessage("Base: " .. base .. " effectiveArmor: " ..  effectiveArmor .. " armor: " .. armor.. " posbuff: " .. posBuff .. " negBuff: " .. negBuff)

    baseDefense, armorDefense = UnitDefense("player");
    DEFAULT_CHAT_FRAME:AddMessage("baseDefense: " .. baseDefense .. " armorDefense: " ..armorDefense)

    chanceDodge = GetDodgeChance()
    DEFAULT_CHAT_FRAME:AddMessage("chanceDodge: " .. SCL_Round(chanceDodge, 0.01))

    chanceBlock = GetBlockChance()
    DEFAULT_CHAT_FRAME:AddMessage("chanceBlock: " .. SCL_Round(chanceBlock, 0.01))

    chanceParry = GetParryChance()
    DEFAULT_CHAT_FRAME:AddMessage("chanceParry: " .. SCL_Round(chanceParry, 0.01))

    baseResilence = GetCombatRating(15)
    DEFAULT_CHAT_FRAME:AddMessage("baseResilence: " .. baseResilence)

    --for i = 1, 24 do
    --    rating = GetCombatRating(i)
    --    DEFAULT_CHAT_FRAME:AddMessage("rating(" ..i.. "): " .. rating)
    --end

end


function SCL_SerializePlayerTalentsSimple()
    local numTalentsTab1 = SCL_GetNumTalentPoints(1);
    local numTalentsTab2 = SCL_GetNumTalentPoints(2);
    local numTalentsTab3 = SCL_GetNumTalentPoints(3);

    numTalentsTab1 = SCL_LPad(tostring(numTalentsTab1), "0", 2)
    numTalentsTab2 = SCL_LPad(tostring(numTalentsTab2), "0", 2)
    numTalentsTab3 = SCL_LPad(tostring(numTalentsTab3), "0", 2)

    return numTalentsTab1 .. numTalentsTab2 .. numTalentsTab3
end

function SCL_DeserializePlayerTalentsSimple(strPlayer, strTalentString)
    if not (SCL_PLAYER[strPlayer]) then
        SCL_PLAYER[strPlayer] = {}
    end

    local numTalents1 = string.sub(strTalentString, 1, 2)
    local numTalents2 = string.sub(strTalentString, 3, 4)
    local numTalents3 = string.sub(strTalentString, 5, 6)

    SCL_PLAYER[strPlayer]["TALENTS1"] = numTalents1
    SCL_PLAYER[strPlayer]["TALENTS2"] = numTalents2
    SCL_PLAYER[strPlayer]["TALENTS3"] = numTalents3
    SCL_PLAYER[strPlayer]["TALENTSSTRING"] = numTalents1 .. "-" .. numTalents2 .. "-" ..numTalents3

    -- infos needed are saved in the variable
    SCL_PLAYER[strPlayer]["TALENTSSTRINGNAME"] = SCL_BuildTalentString(strPlayer)
end

function SCL_BuildTalentString(strName)
    -- we should at least know the player
    if not (SCL_PLAYER[strName]) then
        return "Unknown"
    end

    local numTalentPoints = SCL_GetNumSkillPoints(tonumber(SCL_PLAYER[strName]["LEVEL"]))

    local percentTalents1 = tonumber(SCL_PLAYER[strName]["TALENTS1"]) / numTalentPoints
    local percentTalents2 = tonumber(SCL_PLAYER[strName]["TALENTS2"]) / numTalentPoints
    local percentTalents3 = tonumber(SCL_PLAYER[strName]["TALENTS3"]) / numTalentPoints

    strStringTalents = ""
    
    if(percentTalents1 > 0.7) then
        strStringTalents = "Deep " .. SCL_CONSTS.CLASSTALENTSTRINGS[SCL_PLAYER[strName]["CLASS"]][1]
    elseif(percentTalents1 > 0.3) then
        strStringTalents = SCL_CONSTS.CLASSTALENTSTRINGS[SCL_PLAYER[strName]["CLASS"]][1]
    end
    
    if(percentTalents2 > 0.7) then
        strStringTalents = "Deep " .. SCL_CONSTS.CLASSTALENTSTRINGS[SCL_PLAYER[strName]["CLASS"]][2]
    elseif(percentTalents2 > 0.3) then
        if(strStringTalents == "") then
            strStringTalents = SCL_CONSTS.CLASSTALENTSTRINGS[SCL_PLAYER[strName]["CLASS"]][2]
        else
            strStringTalents = strStringTalents .. "-" .. SCL_CONSTS.CLASSTALENTSTRINGS[SCL_PLAYER[strName]["CLASS"]][2]
        end
    end
    
    if(percentTalents3 > 0.7) then
        strStringTalents = "Deep " .. SCL_CONSTS.CLASSTALENTSTRINGS[SCL_PLAYER[strName]["CLASS"]][3]
    elseif(percentTalents3 > 0.3) then
        if(strStringTalents == "") then
            strStringTalents = SCL_CONSTS.CLASSTALENTSTRINGS[SCL_PLAYER[strName]["CLASS"]][3]
        else
            strStringTalents = strStringTalents .. "-" .. SCL_CONSTS.CLASSTALENTSTRINGS[SCL_PLAYER[strName]["CLASS"]][3]
        end
    end

    return strStringTalents
end

function SCL_GetNumSkillPoints(iLevel)
    if(iLevel < 10) then
        return 0
    else
        return iLevel - 9
    end
end

function SCL_GetNumTalentPoints(iTab)
    local numTalentsInTab = GetNumTalents(iTab)
    local numTalentCount = 0

    for i = 1, (numTalentsInTab + 1) do
        name, iconPath, tier, column, currentRank, maxRank, isExceptional, meetsPrereq = GetTalentInfo(iTab, i);
        numTalentCount = numTalentCount + currentRank
    end

    DEFAULT_CHAT_FRAME:AddMessage("Tab: " ..iTab.. " Talents: " ..numTalentCount)

    return numTalentCount;
end

function SCL_OnEvent(self, event, ...)

    if (event == 'CHAT_MSG_ADDON') then
        if(arg1 == 'SCLRI') then
            SendAddonMessage("SCLII", SCL_SerializePlayer(), "WHISPER", arg4);
        elseif(arg1 == "SCLII") then
            SCL_DeserializePlayerItemsStringShort(arg2, arg4)
            SCL_ShowCharacterFrame(arg4)
        end
    end

end

function SCL_DeserializePlayerItemsStringShort(strItemsString, strPlayer)

    local itemStrings = {string.split(":", strItemsString)}

    for i = 1, table.getn(itemStrings) do

        local strRebuiltItemstring = SCL_RebuildItemString(itemStrings[i])

        if not (SCL_PLAYER[strPlayer]) then
            SCL_PLAYER[strPlayer] = {}
        end

        SCL_PLAYER[strPlayer][SCL_CONSTS.SLOTIDSTRING[tostring(i)]] = strRebuiltItemstring

    end
    
end

function SCL_DeserializePlayerItemString(strItemString, strPlayer)

    for i = 0, 16 do
        currentInfo = string.sub(strItemString, i * 25 + 1, (i + 1) * 25)

        local strRebuiltItemstring = SCL_RebuildItemString(currentInfo)

        if not (SCL_PLAYER[strPlayer]) then
            SCL_PLAYER[strPlayer] = {}
        end

        DEFAULT_CHAT_FRAME:AddMessage("I: " ..tostring(i))

        SCL_PLAYER[strPlayer][SCL_CONSTS.SLOTIDSTRING[tostring(i)]] = strRebuiltItemstring
    end

end

function SCL_RebuildItemString(strItemString)

    local ItemInfoStrings = {string.split(",", strItemString)}

    if(ItemInfoStrings[1] == nil or ItemInfoStrings[1] == "") then
        itemID = "0"
    else
        itemID = ItemInfoStrings[1]
    end

    if(ItemInfoStrings[2] == nil or ItemInfoStrings[2] == "") then
        enchantID = "0"
    else
        enchantID = ItemInfoStrings[2]
    end

    if(ItemInfoStrings[3] == nil or ItemInfoStrings[3] == "") then
        gem1 = "0"
    else
        gem1 = ItemInfoStrings[3]
    end

    if(ItemInfoStrings[4] == nil or ItemInfoStrings[4] == "") then
        gem2 = "0"
    else
        gem2 = ItemInfoStrings[4]
    end

    if(ItemInfoStrings[5] == nil or ItemInfoStrings[5] == "") then
        gem3 = "0"
    else
        gem3 = ItemInfoStrings[5]
    end

    if(ItemInfoStrings[6] == nil or ItemInfoStrings[6] == "") then
        gem4 = "0"
    else
        gem4 = ItemInfoStrings[6]
    end

    local strNewItemString = "item:" ..itemID.. ":" ..enchantID.. ":" ..gem1.. ":" ..gem2.. ":" ..gem3.. ":"..gem4.. ":0:0"
    
    return strNewItemString
end

function SCL_OnUpdate(self, elapsed)

end

function SCL_ShowCharWindow()
    MyFrame = CreateFrame("Frame")
    MyFrame:ClearAllPoints()
    MyFrame:SetBackdrop(StaticPopup1:GetBackdrop())
    MyFrame:SetHeight(300)
    MyFrame:SetWidth(300)
    
    MyFrame.text = MyFrame:CreateFontString(nil, "BACKGROUND", "GameFontNormal")
    MyFrame.text:SetAllPoints()
    MyFrame.text:SetText("YOUR HELP TEXT HERE")
    MyFrame:SetPoint("CENTER", 0, 0)
end

function SCL_SetFrameInfo(strUnitName)
    SCL_InspectNameText:SetText(strUnitName);
    SCL_InspectLevelText:SetText("Level: " .. SCL_PLAYER[strUnitName]["LEVEL"] .. " " .. SCL_PLAYER[strUnitName]["CLASS"] .. " " .. SCL_PLAYER[strUnitName]["RACE"]);
    SCL_InspectTitleText:SetText("Skillung: " .. SCL_PLAYER[strUnitName]["TALENTSSTRINGNAME"] .. " (" .. SCL_PLAYER[strUnitName]["TALENTSSTRING"] .. ")");
    CharLinkRejectPlayerClass:SetNormalTexture(SCL_CONSTS.CLASSICONS[SCL_PLAYER[strUnitName]["CLASS"]])
    CharLinkRejectPlayerClass:SetPushedTexture(SCL_CONSTS.CLASSICONS[SCL_PLAYER[strUnitName]["CLASS"]])

    if(SCL_PLAYER[strUnitName]["CLASS"] == "ROGUE") then
        SCL_PlayerMana:SetStatusBarColor(1,1,0)
    elseif(SCL_PLAYER[strUnitName]["CLASS"] == "WARRIOR") then
        SCL_PlayerMana:SetStatusBarColor(1,0,0)
    else
        SCL_PlayerMana:SetStatusBarColor(0,0,1)
    end
    SCL_PlayerHealthText:SetText(SCL_PLAYER[strUnitName]["HEALTHMAX"])
    SCL_PlayerManaText:SetText(SCL_PLAYER[strUnitName]["MANAMAX"])

    -- portrait is set depending on race+sex
    -- e.g. Draenei1 = male
    --      Draenei2 = female
    --SCL_CONSTS.RACESEXTOTEXTURE["DEFAULT"]

    if(SCL_CONSTS.RACESEXTOTEXTURE[SCL_PLAYER[strUnitName]["RACE"] .. SCL_PLAYER[strUnitName]["SEX"]]) then
        SetPortraitToTexture(SCL_InspectFramePortrait, SCL_CONSTS.RACESEXTOTEXTURE[SCL_PLAYER[strUnitName]["RACE"] .. SCL_PLAYER[strUnitName]["SEX"]]);
    else
        SetPortraitToTexture(SCL_InspectFramePortrait, SCL_CONSTS.RACESEXTOTEXTURE["DEFAULT"]);
    end
end

function SCL_ShowCharacterFrame(strPlayer)

    if(strPlayer == nil or strPlayer == "") then
        return
    end

    PlaySound("igCharacterInfoOpen");
    --SetPortraitTexture(SCL_InspectFramePortrait, "player");
    SCL_SetFrameInfo(strPlayer);

    SCL_ItemSlotButton_Update(SCL_InspectHeadSlot);
    SCL_ItemSlotButton_Update(SCL_InspectNeckSlot);
    SCL_ItemSlotButton_Update(SCL_InspectShoulderSlot);
    SCL_ItemSlotButton_Update(SCL_InspectBackSlot);
    SCL_ItemSlotButton_Update(SCL_InspectChestSlot);
    SCL_ItemSlotButton_Update(SCL_InspectShirtSlot);
    SCL_ItemSlotButton_Update(SCL_InspectTabardSlot);
    SCL_ItemSlotButton_Update(SCL_InspectWristSlot);
    SCL_ItemSlotButton_Update(SCL_InspectHandsSlot);
    SCL_ItemSlotButton_Update(SCL_InspectWaistSlot);
    SCL_ItemSlotButton_Update(SCL_InspectLegsSlot);
    SCL_ItemSlotButton_Update(SCL_InspectFeetSlot);
    SCL_ItemSlotButton_Update(SCL_InspectFinger0Slot);
    SCL_ItemSlotButton_Update(SCL_InspectFinger1Slot);
    SCL_ItemSlotButton_Update(SCL_InspectTrinket0Slot);
    SCL_ItemSlotButton_Update(SCL_InspectTrinket1Slot);
    SCL_ItemSlotButton_Update(SCL_InspectMainHandSlot);
    SCL_ItemSlotButton_Update(SCL_InspectSecondaryHandSlot);
    SCL_ItemSlotButton_Update(SCL_InspectRangedSlot);

    SCL_InspectFrame:Show()
end

function SCL_AddCharacterLink()

    -- This is for WIM compatibility
    -- Step 1: Check if WIM is loaded
    if(IsAddOnLoaded("WIM")) then
        -- Step 2: iterate through all children of UI parent
        for i = 1, select('#', UIParent:GetChildren()) do
            -- Step 3: it might be a wim_window
            local wim_messageframe = select(i, UIParent:GetChildren())

            -- Step 3.1: has the frame a name?
            if(wim_messageframe:GetName()) then
                -- Step 3.2: Does the name start with "WIM_msgFrame"? (They are called WIM_msgFrame1, WIM_msgFrame2, etc.)
                if(string.sub(wim_messageframe:GetName(), 0,12) == "WIM_msgFrame") then

                    -- Step 4: iterate through all children of  the WIM_msgFrame
                    for j = 1, select('#', wim_messageframe:GetChildren()) do
                        -- Step 5: it might be a MsgBox (Input box)
                        local wim_messageframe_edit = select(j, wim_messageframe:GetChildren())
                        -- Step 5.1: Frame name contains MsgBox at the end?(They are called IM_msgFrame1MsgBox, WIM_msgFrame2MsgBox, etc) and the parent frame is shown?
                        if(string.sub(wim_messageframe_edit:GetName(), 14,19) == "MsgBox" and wim_messageframe:IsShown()) then

                            -- Step 5.2: the input box has focus?
                            if(wim_messageframe_edit:HasFocus()) then
                                -- Step 6: add message
                                if(wim_messageframe_edit:GetText() ~= "") then
                                    wim_messageframe_edit:SetText(wim_messageframe_edit:GetText() .. SCL_BuildPlayerString() .. " ")
                                else
                                    wim_messageframe_edit:SetText(SCL_BuildPlayerString() .. " ")
                                end

                                return
                            end

                        end
                    end
                end
            end
        end
    end

    -- this is called if no WIM window has been found
    chatFrame = DEFAULT_CHAT_FRAME;

    chatFrame.editBox:Show();
    chatFrame.editBox.setText = 1;

    if(chatFrame.editBox:GetText() ~= "") then
        chatFrame.editBox.text = chatFrame.editBox:GetText() .. " " .. SCL_BuildPlayerString() .. " ";
    else
        chatFrame.editBox.text = SCL_BuildPlayerString() .. " ";
    end
end

function SCL_OnShow()

end
 
function SCL_OnHide()
  PlaySound("igCharacterInfoClose");
end

function SCL_BuildPlayerString()
    local strPlayerItemString = "|cff"

    local localizedClass, englishClass, classIndex = UnitClass("player");

    strPlayerItemString = strPlayerItemString .. SCL_CONSTS.CLASSCOLOR[englishClass]

    -- "|Hitem:1:1:0:0:0:0:0:0|h[asdf]h|r"

    strPlayerItemString = strPlayerItemString .. "|Hitem:1:1:"

    strPlayerItemString = strPlayerItemString .. SCL_SerializePlayerBaseinfo() -- contains level, race, class, sex
    
    strPlayerItemString = strPlayerItemString .. ":"
    
    strPlayerItemString = strPlayerItemString .. SCL_SerializePlayerTalentsSimple() -- contains talents for each tab

    strPlayerItemString = strPlayerItemString ..":"
    
    strPlayerItemString = strPlayerItemString .. SCL_SerializePlayerStatsSimple() -- contains maxmana / maxhp

    strPlayerItemString = strPlayerItemString .. ":0:0:0|h["

    strPlayerItemString = strPlayerItemString .. UnitName("player")

    strPlayerItemString = strPlayerItemString .. "]|h|r"

    return strPlayerItemString
end

function SCL_SerializePlayerStatsSimple()
    mana = UnitManaMax("player")
    health = UnitHealthMax("player")

    return (SCL_LPad(mana, "0", 5) .. SCL_LPad(health, "0", 5))
end

function SCL_SerializePlayerBaseinfo()
    -- LLCRS
    -- LL = Level
    -- C  = Class
    -- R = Race
    -- S  = Sex

    strPlayerBaseInfo = SCL_BaseInfo_Level()
    strPlayerBaseInfo = strPlayerBaseInfo .. SCL_BaseInfo_Class()
    strPlayerBaseInfo = strPlayerBaseInfo .. SCL_BaseInfo_Race()
    strPlayerBaseInfo = strPlayerBaseInfo .. SCL_BaseInfo_Sex()
    return strPlayerBaseInfo

end

function SCL_BaseInfo_Level()
    if(UnitLevel("player") < 10) then
        return "0" + UnitLevel("player")
    else
        return UnitLevel("player")
    end
end

function SCL_BaseInfo_Class()
    localizedClass, englishClass, classIndex = UnitClass("player");

    return SCL_CONSTS.CLASSTOSTRINGID[englishClass]
end

function SCL_BaseInfo_Race()
    return SCL_CONSTS.RACETOSTRINGID[UnitRace("player")]
end

function SCL_BaseInfo_Sex()
    return UnitSex("player")
end

function SCL_SerializePlayer()
    local strSerializedPlayerShort = ""

    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("HEADSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("NECKSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("SHOULDERSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("BACKSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("CHESTSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("SHIRTSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("TABARDSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("WRISTSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("HANDSSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("WaistSlot") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("LEGSSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("FEETSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("FINGER0SLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("FINGER1SLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("TRINKET0SLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("TRINKET1SLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("MAINHANDSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("SECONDARYHANDSLOT") .. ":"
    strSerializedPlayerShort = strSerializedPlayerShort .. SCL_SerializeSlotShort("RANGEDSLOT")

    return strSerializedPlayerShort
end


function SCL_SerializeSlotShort(strSlotName)
    local strReturnString = ""
    
    if(strSlotName == "") then
        return strReturnString
    end

    -- return strReturnString
    -- step 1: get the inv slot info
    slotId, textureName = GetInventorySlotInfo(strSlotName)
    
    -- no slot id? something went wrong
    if not (slotId) then
        return strReturnString;
    end
    
    -- step 2: get item link of slot
    local link = GetInventoryItemLink("player", slotId)
    
    -- no link? something went wrong
    if not (link) then
        return strReturnString;
    end

    -- step 3: analyze link
    local r,g,b,itemID,enchant,gem1,gem2,gem3,gem4,G,H,name = link:match("^|cff(%x%x)(%x%x)(%x%x)|Hitem:(%d+):(%d+):(%d+):(%d+):(%d+):(%d+):(%-?%d+):(%d+)|h%[(.+)%]|h|r$")

    -- no item?
    if(itemID == "0" or itemID == nil) then
        return strReturnString;
    end

    if (itemID == nil or itemID == "0") then
        itemID = ""
    end

    if (enchant == nil or enchant == "0") then
        enchant = ""
    end

    if (gem1 == nil or gem1 == "0") then
        gem1 = ""
    end

    if (gem2 == nil or gem2 == "0") then
        gem2 = ""
    end

    if (gem3 == nil or gem3 == "0") then
        gem3 = ""
    end

    if (gem4 == nil or gem4 == "0") then
        gem4 = ""
    end

    strReturnString = itemID .. "," .. enchant .. "," .. gem1 .. "," .. gem2 .. "," .. gem3 .. "," .. gem4
    return strReturnString;
end

function SCL_LPad(strValue, strPadChar, iPadLength)

    if (strValue == nil) then
        strValue = ""
    end
    
    if(string.len(strValue) >= iPadLength) then
        return strValue;
    end
    
    local strReturnString = ""
    
    for i = 0, (iPadLength - string.len(strValue) -1) do
        strReturnString = strReturnString .. strPadChar
    end
    
    strReturnString = strReturnString .. strValue

    return tostring(strReturnString)
end

function SCL_ItemSlotButton_OnLoad()
    local slotName = this:GetName();
    local id;
    local textureName;
    local checkRelic;
    -- TODO
    --id, textureName, checkRelic = GetInventorySlotInfo(strsub(slotName,8));
    --this:SetID(id);
    --local texture = getglobal(slotName.."IconTexture");
    --texture:SetTexture(textureName);
    --this.backgroundTextureName = textureName;
    --this.checkRelic = checkRelic;
end

function SCL_InvitePlayer()
    --SCL_InspectNameText:GetText()

    SendChatMessage("Hallo " ..SCL_InspectNameText:GetText().. ", du bist dabei!", "WHISPER", nil, SCL_InspectNameText:GetText())
    InviteUnit(SCL_InspectNameText:GetText())
    SCL_InspectFrame:Hide()
end

function SCL_RejectPlayer(strReason)

    if(strReason == "EQUIPMENT") then
        SendChatMessage("Hallo " ..SCL_InspectNameText:GetText().. ", leider reicht dein Equipment nicht aus.", "WHISPER", nil, SCL_InspectNameText:GetText())
    elseif(strReason == "ENCHANT") then
        SendChatMessage("Hallo " ..SCL_InspectNameText:GetText().. ", leider ist dein Equipment nicht ausreichend verzaubert.", "WHISPER", nil, SCL_InspectNameText:GetText())
    elseif(strReason == "GEMS") then
        SendChatMessage("Hallo " ..SCL_InspectNameText:GetText().. ", leider ist dein Equipment nicht ausreichend gesockelt.", "WHISPER", nil, SCL_InspectNameText:GetText())
    elseif(strReason == "CLASS") then
        SendChatMessage("Hallo " ..SCL_InspectNameText:GetText().. ", leider brauche ich deine Klasse nicht mehr.", "WHISPER", nil, SCL_InspectNameText:GetText())
    else
        SendChatMessage("Hallo " ..SCL_InspectNameText:GetText().. ", leider passt du nicht in meine Gruppenplanung.", "WHISPER", nil, SCL_InspectNameText:GetText())
    end

    SCL_InspectFrame:Hide()

end

function SCL_ItemSlotButton_OnEnter()
    GameTooltip:SetOwner(this, "ANCHOR_RIGHT");

    local text = strupper(strsub(this:GetName(), 12));

    GameTooltip:SetHyperlink(SCL_PLAYER[SCL_InspectNameText:GetText()][text])

    CursorUpdate();
end
-- 
function SCL_ItemSlotButton_Update(button)

  local text = strupper(strsub(button:GetName(), 12));

    -- set default in case
    SetItemButtonTexture(button, SCL_CONSTS.SLOTSTRINGICON[text]);

    local itemID = tonumber((SCL_PLAYER[SCL_InspectNameText:GetText()][text] or ""):match(".-item:(%d+):.*"))

    if not (itemID) then
        return
    end

    local textureName = GetItemIcon(itemID) 


    if ( textureName ) then
        SetItemButtonTexture(button, textureName);
        button.hasItem = 1;
    end

  itemName, itemLink, itemRarity, itemLevel, itemMinLevel, itemType, itemSubType, itemStackCount, itemEquipLoc, itemTexture, itemSellPrice = GetItemInfo(itemID) 

    if ( GameTooltip:IsOwned(button) ) then
        if ( texture ) then
            GameTooltip:SetHyperlink(SCL_PLAYER[SCL_InspectNameText:GetText()][text])
        else
            GameTooltip:Hide();
        end
    end

end